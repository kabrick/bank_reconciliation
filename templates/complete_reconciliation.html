{% extends "base.html" %}

{% block title %} Complete Reconciliation {% endblock %}

{% block content %}

    <div class="white-box">
        <h1 class="text-center">Complete Reconciliation</h1>
        <br><br>

        <div class="row">
            <div class="col-md-5">
                <h3>Bank Transactions</h3>

                <hr>

                <div class="table-responsive">
                    <table class="table table-striped table-bordered border-success">
                        <thead>
                        <tr>
                            <th>Transaction Date</th>
                            <th>Transaction Memo</th>
                            <th>Credit</th>
                            <th>Debit</th>
                            <th>Account Balance</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for record in banking_records %}
                            <tr>
                                <td>{{ record['timestamp'] }}</td>
                                <td>{{ record['memo'] }}</td>
                                <td>{{ record['credit_amount'] }}</td>
                                <td>{{ record['debit_amount'] }}</td>
                                <td>{{ record['balance_after'] }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <a id="view_all_bank_btn" class="link-success">View All Bank Transactions</a>
            </div>
            <div class="col-md-2"></div>
            <div class="col-md-5">
                <h3>System Transactions</h3>

                <hr>

                <div class="table-responsive">
                    <table class="table table-striped table-bordered border-success">
                        <thead>
                        <tr>
                            <th>Transaction Date</th>
                            <th>Transaction Memo</th>
                            <th>Credit</th>
                            <th>Debit</th>
                            <th>Account Balance</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for record in system_records %}
                            <tr>
                                <td>{{ record['timestamp'] }}</td>
                                <td>{{ record['memo'] }}</td>
                                <td>{{ record['credit_amount'] }}</td>
                                <td>{{ record['debit_amount'] }}</td>
                                <td>{{ record['balance_after'] }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <a id="view_all_system_btn" class="link-success">View All System Transactions</a>
            </div>
        </div>

        <hr>

        <h2 class="text-center">Results</h2>

        <br>

        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="transactions_reconciled_heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#transactions_reconciled" aria-expanded="true" aria-controls="transactions_reconciled">
                        232 Transactions have been reconciled
                    </button>
                </h2>
                <div id="transactions_reconciled" class="accordion-collapse collapse" aria-labelledby="transactions_reconciled_heading"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <a id="view_reconciled_transactions_btn" class="link-success">View Transactions</a>
                        <div class="vr"></div>
                        <a href="{{ url_for('print_test') }}" target="_blank" class="link-success">Print Transactions</a>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="system_transactions_missed_heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#system_transactions_missed" aria-expanded="false" aria-controls="system_transactions_missed">
                        52 System transactions have no bank transaction matches
                    </button>
                </h2>
                <div id="system_transactions_missed" class="accordion-collapse collapse" aria-labelledby="system_transactions_missed_heading"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <a id="view_system_transactions_btn" class="link-success">View Transactions</a>
                        <div class="vr"></div>
                        <a href="{{ url_for('print_test') }}" target="_blank" class="link-success">Print Transactions</a>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="bank_transactions_missed_heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#bank_transactions_missed" aria-expanded="false" aria-controls="bank_transactions_missed">
                        0 Bank transactions have no system transaction matches
                    </button>
                </h2>
                <div id="bank_transactions_missed" class="accordion-collapse collapse" aria-labelledby="bank_transactions_missed_heading"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <a id="view_bank_transactions_missed_btn" class="link-success">View Transactions</a>
                        <div class="vr"></div>
                        <a href="{{ url_for('print_test') }}" target="_blank" class="link-success">Print Transactions</a>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <div class="text-center" style="margin-bottom: 50px">
            <a class="btn btn-primary" href="{{ url_for('complete_reconciliation') }}">Save Reconciliation Report</a>
        </div>
	</div>

    <div class="modal fade" id="reconcile_progress_modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="reconcile_progress_modal_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h1 class="modal-title fs-5" id="reconcile_progress_modal_label">Reconciliation in Progress</h1>
                </div>
                <div class="modal-body">
                    <button class="btn btn-primary text-center" type="button" disabled>
                        <br>
                        <span class="spinner-border spinner-border-lg" role="status" aria-hidden="true"></span>
                        <br><br>
                        <b>Reconciliation is now running, please wait and do not reload this page...</b>
                    </button>
                </div>
                <div class="modal-footer"></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="custom_modal" data-bs-backdrop="static" data-bs-keyboard="false"
         tabindex="-1" aria-labelledby="custom_modal_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h1 class="modal-title fs-5" id="custom_modal_label"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="custom_modal_content"></div>
                </div>
                <div class="modal-footer"></div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            {#$.ajax({
                url: '/long_task',
                type: 'GET',
                beforeSend: function () {
                    // Show the progress bar modal before sending the request
                    $('#reconcile_progress_modal').modal('show');
                },
                success: function (response) {
                    // Hide the progress bar modal and show the success/failure message
                    $('#reconcile_progress_modal').modal('hide');

                    if (response.result == 1) {
                        $("#message").html("<p class='text-success'>Success!</p>");
                    } else {
                        $("#message").html("<p class='text-danger'>Failure!</p>");
                    }
                }
            });#}

        });

        $('#view_all_bank_btn').click(function() {
            $('#custom_modal_label').text("View All Bank Transactions");
            $('#custom_modal_content').html("");
            $('#custom_modal').modal('show');
        });

        $('#view_all_system_btn').click(function () {
            $('#custom_modal_label').text("View All System Transactions");
            $('#custom_modal').modal('show');
        });

        $('#view_reconciled_transactions_btn').click(function () {
            $('#custom_modal_label').text("Reconciled Transactions");
            $('#custom_modal').modal('show');
        });

        $('#view_system_transactions_btn').click(function () {
            $('#custom_modal_label').text("System Transactions With No Match");
            $('#custom_modal').modal('show');
        });

        $('#view_bank_transactions_missed_btn').click(function () {
            $('#custom_modal_label').text("Bank Transactions With No Match");
            $('#custom_modal').modal('show');
        });
    </script>

{% endblock %}